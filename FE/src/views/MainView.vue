<template>
  <!-- ìºë£¨ì…€ -->
  <div
    title="ìºë£¨ì…€"
    id="carouselExampleIndicators"
    class="carousel slide h-250"
  >
    <div class="carousel-indicators">
      <button
        class="active"
        id="button1"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide-to="0"
        aria-current="true"
        aria-label="Slide 1"
      ></button>
      <button
        id="button2"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide-to="1"
        aria-label="Slide 2"
      ></button>
      <button
        id="button3"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide-to="2"
        aria-label="Slide 3"
      ></button>
    </div>
    <div v-if="popupgood" class="carousel-inner">
      <div @click="goDetail(popupgood[0].popupId)" class="carousel-item active">
        <img
          :src="popupgood[0].popupImagePath"
          class="d-block w-100 rounded-4"
          alt="ì´ë¯¸ì§€ ì—†ìŒ"
        />
      </div>
      <div @click="goDetail(popupgood[1].popupId)" class="carousel-item">
        <img
          :src="popupgood[1].popupImagePath"
          class="d-block w-100 rounded-4"
          alt="ì´ë¯¸ì§€ ì—†ìŒ"
        />
      </div>
      <div @click="goDetail(popupgood[2].popupId)" class="carousel-item">
        <img
          :src="popupgood[2].popupImagePath"
          class="d-block w-100 rounded-4"
          alt="ì´ë¯¸ì§€ ì—†ìŒ"
        />
      </div>
    </div>
  </div>
<!-- ë§ˆê°ì„ë°• íŒì—…ìŠ¤í† ì–´ ë¦¬ìŠ¤íŠ¸ -->
<div class="deadline-container">
  <div class="deadline-text-group">
    <h5 style="opacity: 0.84;
        font-size: 20px;
        font-weight: 800;
        line-height: 30px;
        word-break: keep-all;
        letter-spacing: 1px;">ë§ˆê°ì„ë°• â° </h5>

   <!-- <div href="#"
        style="width: 100%;
        height: 100%;
        text-align:right;
        color: #747688;
        font-size: 13px;
        font-weight: 400;
        line-height: 23px;
        word-wrap: break-word">ë”ë³´ê¸°</div> -->
  </div>
  <div title="ë§ˆê°ì„ë°• íŒì—…ë¦¬ìŠ¤íŠ¸ " class="deadline-popup-group" style="margin-bottom:20px;">
    <template v-for="(popup, key) in popupend" :key="key">
      <div @click="goDetail(popup.popupId)" class="deadline-popup">
        <img
          :src="popupend[key].previewImagePath"
          class="deadline-popup-img"
          alt=""
        />
        <span @click="goDetail(popup.popupId)" class="deadline-popup-title" style="font-weight:bold;">
          {{ popup.popupName }}
        </span>
        <span style="font-size:11px; color:gray;">{{ popup.popupEnd }}</span>
      </div>
    </template>
  </div>
</div>


  <!-- ì¹´í…Œê³ ë¦¬ -->
  <div class="main-category">
    <div class="main-category-text">
      <h5 style="opacity: 0.84;
        font-size: 20px;
        font-weight: 800;
        line-height: 30px;
        word-break: keep-all;
        letter-spacing: 1px;">ì¹´í…Œê³ ë¦¬ ğŸ—ºï¸
      </h5>
    </div>
    <div class="main-category-container">
      <div class="main-category-text">
       <img
          class="main-category-logo"
          src="@/assets/images/category_beauty.png"
          alt="íŒ¨ì…˜ë·°í‹°"
        />
        <span style="font-size:10px; font-weight:bold;">íŒ¨ì…˜/ë·°í‹°</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_foods.png"
          alt="ì‹ìŒë£Œ"
        />
        <span style="font-size:10px; font-weight:bold;">ì‹ìŒë£Œ</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_content.png"
          alt="ì½˜í…ì¸ "
        />
        <span style="font-size:10px; font-weight:bold;">ì½˜í…ì¸ </span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_hobby.png"
          alt="ì·¨ë¯¸ì—¬ê°€"
        />
        <span style="font-size:10px; font-weight:bold;">ì·¨ë¯¸/ì—¬ê°€</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_finance.png"
          alt="ê¸ˆìœµ"
        />
        <span style="font-size:10px; font-weight:bold;">ê¸ˆìœµ</span>
      </div>
    </div>
    <div class="main-category-container">
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_entertain.png"
          alt="ì—°ì˜ˆ"
        />
        <span style="font-size:10px; font-weight:bold;">ì—°ì˜ˆ</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_digital.png"
          alt="ê°€ì „/ë””ì§€í„¸"
        />
        <span style="font-size:10px; font-weight:bold;">ê°€ì „/ë””ì§€í„¸</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_living.png"
          alt="ë¦¬ë¹™"
        />
        <span style="font-size:10px; font-weight:bold;">ë¦¬ë¹™</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_game.png"
          alt="ê²Œì„"
        />
        <span style="font-size:10px; font-weight:bold;">ê²Œì„</span>
      </div>
      <div class="main-category-text">
        <img
          class="main-category-logo"
          src="@/assets/images/category_character.png"
          alt="ìºë¦­í„°"
        />
        <span style="font-size:10px; font-weight:bold;">ìºë¦­í„°</span>
      </div>
    </div>
  </div>
</template>

<script setup>
import { useRouter } from 'vue-router';
import { ref, onMounted } from 'vue';
import axios from 'axios';
import { compileScript } from 'vue/compiler-sfc';
import { home } from '@/api/popup' 

const router = useRouter()

const popupend = ref()
const popupgood = ref()

onMounted(() => {
  home(
    ({ data }) => {
      console.log(data);
      console.log(data.popupend);
      popupend.value = data.popupend;
      popupgood.value = data.popupgood;
    },
    ({ response }) => {
      console.log(response);
    }
  );
  // ì¹´í…Œê³ ë¦¬ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ê°ì‹œ
  const selectedCategory = document.querySelectorAll('.main-category-logo')

  for (let i = 0; i < selectedCategory.length; i++) {
      selectedCategory[i].addEventListener('click', function(event) {
      // í´ë¦­í•œ ìš”ì†Œì˜ altê°’ì„ ì¸ìë¡œ ê°€ì§€ê³  í†µí•©ê²€ìƒ‰ í˜ì´ì§€ë¡œ ì´ë™
      const categoryName = event.target.alt
      router.push({ name: 'search', params: {'category': categoryName}})
      })
  }
});

function openCamera() {
  navigator.mediaDevices
    .getUserMedia({ video: true })
    .then((stream) => {
      const video = document.createElement("video");
      video.srcObject = stream;
      video.autoplay = true;
      video.onloadedmetadata = () => {
        const canvas = document.createElement("canvas");
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        canvas.getContext("2d").drawImage(video, 0, 0);
        this.imageUrl = canvas.toDataURL("image/png");
        stream.getTracks().forEach((track) => track.stop());
      };
    })
    .catch((error) => {
      console.error("ì¹´ë©”ë¼ ì•¡ì„¸ìŠ¤ ê±°ë¶€:", error);
    });
}

function openGallery() {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*";
  input.onchange = (event) => {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (e) => {
        this.imageUrl = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  };
  input.click();
}

// íŒì—…ìŠ¤í† ì–´ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™
const goDetail = (popupId) => {
  router.push({ name: 'popup-detail', params: { popupId }})
}
</script>

<style scoped>
/* ì´ë¯¸ì§€ë‘ ìºëŸ¬ì…€ ì„¸ë¡œ ì‚¬ì´ì¦ˆ í†µì¼(ì „ì²´ ê¸¸ì´ì˜ ì•½ 1/3) */
img {
  height: 279px;
}
.carousel {
  height: 279px;
  position: relative;
}

/* [ìˆ˜ì •ì¤‘] ì¸ë””ì¼€ì´í„° ë™ê·¸ë—ê²Œ ë§Œë“¤ê¸° */
.carousel-indicators {
  position: absolute;
  bottom: 0%;
}

/* #button1 {
  width: 3px;
  height: 3px;
  left: 50%;
  top: 0px;
  position: absolute;
  background: #616266;
  border-radius: 9999px;
}

#button2 {
  width: 9px;
  height: 9px;
  left: 13px;
  top: 0px;
  position: absolute;
  background: #E2E2E2;
  border-radius: 9999px;
}

#button3 {
  width: 9px;
  height: 9px;
  left: 26px;
  top: 0px;
  position: absolute;
  background: #E2E2E2;
  border-radius: 9999px;
} */

.deadline-text-group {
  display: flex;
  justify-content: space-between;
  width: 316px;
  height: 30px;
  flex-shrink: 0;
}

.deadline-container {
  margin-left: 20px;
  margin-right: 20px;
  margin-top: 30px;
}

.main-category-logo {
  width: 42px;
  height: 42px;
}

.main-category-text {
  display: flex;
  flex-direction: column;
  font-size: 7px;
  font-family: 'NanumSquareNeo-Variable';
  font-weight: 400;
  line-height: 22px;
}

.main-category-container {
 /* width: 282px; */
  display: flex;
  text-align: center;
  justify-content: space-between;
  margin: 10px;

}

.deadline-popup-group {
  margin-top: 10px;
  min-width: 201.78px;
  height: 200px;
  overflow-x: scroll;
  white-space: nowrap;
  display: flex;
  align-items: flex-start; /* ìì‹ ìš”ì†Œê°€ ë¶€ëª¨ ìš”ì†Œì˜ í¬ê¸°ë¥¼ ë²—ì–´ë‚˜ì§€ ì•Šë„ë¡ ìˆ˜ì • */
}

.deadline-popup {
  width: 200px;
  height: 195.78px;
  margin-right: 10px;
  border-radius: 10%;
  display:flex;
  flex-direction:column;
  padding: 0px 5px;
}

.deadline-popup span {
  width: 150px; /* ë¶€ëª¨ ìš”ì†Œì¸ .deadline-popupì˜ ë„ˆë¹„ì— ë§ì¶”ì–´ ì¡°ì • */
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

.deadline-popup-img {
  width: 150px;
  height: 150px;
  border-radius: 20%;
}

.main-category {
  margin-left:20px;
  margin-right:20px;
  margin-top:30px;
}

.main-category-text {
    display: flex;
    justify-content: space-between;
}

.deadline-popup-title{
  padding: 5px 0px;
  font-size: 13px;
}

/* ìŠ¤í¬ë¡¤ ì•ˆë³´ì´ê²Œ ìˆ¨ê¸°ê¸° */
.deadline-popup-group {
  -ms-overflow-style: none;
}
.deadline-popup-group::-webkit-scrollbar {
  display: none;
}
</style>
